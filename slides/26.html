<!DOCTYPE html>
<html lang="en">

<head>
  <title>Learning-Enabled Verification of Distributed Systems with End-to-End Proofs</title>
  <link href='https://fonts.googleapis.com/css?family=Open Sans' rel='stylesheet'>
  <link href="../reset.css" rel="stylesheet" type="text/css" />
  <link href="../style.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <div class="title-box">
    <div class="title">Trio Case Study</div>
  </div>
  <div class="half-box" style="font-size: 16pt; margin-top: -3em; margin-bottom: 3em;">
    <div style="margin-left: 80px; margin-right: 80px;">
<pre id="background"><code>type bool = | True | False

type nat =
  | O
  | S of nat

type cmp = | LT | EQ | GT

let compare =
  fix (compare : nat -> nat -> cmp) =
    fun (x1 : nat) ->
      fun (x2 : nat) ->
        match x1 with
        | O -> (match x2 with
                | O -> EQ
                | S _ -> LT)
        | S x1 -> (match x2 with
                | O -> GT
                | S x2 -> compare x1 x2);;
</code></pre>
<br>
<pre id="message_chains"><code>type mref = | N1 | N2 | N3 | N4

type message_chain =
  | Empty
  | Send of mref * mref * nat * message_chain
</code></pre>
<br>
<pre id="command"><code>synth message_chain -> bool satisfying</code></pre>
    </div>
  </div>

  <div class="half-box" style="font-size: 16pt; margin-top: -3em; margin-bottom: 3em;">
    <div style="margin-right: 80px">
<pre id="positives"><code>[Empty] -> True,
[Send(N1, N2, 1, Empty)] -> True,
[Send(N2, N3, 2, Empty)] -> True,
[Send(N1, N2, 4, Send(N4, N1, 4, Empty))] -> True,
[Send(N4, N1, 3, Send(N3, N4, 2, Empty))] -> True,
[Send(N4, N1, 4, Send(N3, N4, 3, Send(N2, N3, 2, Empty)))] -> True,
[Send(N4, N1, 4, Send(N3, N4, 3, Send(N2, N3, 2, Send(N1, N2, 1,Empty))))] -> True,
[Send(N3, N4, 4, Send(N2, N3, 4, Send(N1, N2, 4, Send(N4, N1, 4,Empty))))] -> True,
</code></pre>
<br>
<pre id="negatives"><code>[Send(N2, N1, 0, Send(N1, N2, 1, Empty))] -> False,
[Send(N1, N4, 3, Send(N3, N4, 4, Empty))] -> False,
[Send(N4, N3, 4, Send(N4, N1, 5, Send(N4, N2, 2, Empty)))] -> False,
</code></pre>
<br>
<pre id="solution"><code>let rec (f : (message_chain -> bool)) = 
  fun (x:message_chain) -> 
    match x with
    Empty(_) -> 
      True([])
    Send(_) -> 
      match (Un_Send(x)).3 with
      Empty(_) -> 
        True([])
      Send(_) -> 
        match ((compare (Un_Send(x)).2) (Un_Send((Un_Send(x)).3)).2) with
        EQ(_) -> 
          True([])
        GT(_) -> 
          True([])
        LT(_) -> 
          False([])</code></pre>
    </div>
  </div>
  <div class="foot-box">
    <div class="footnote">Thank you to Amar Shah, Anirban Sarkar, and Zili Wang for finding Trio and running this example</div>
    <div class="slide-number"></div>
  </div>
</body>


<script type="module">
  import { annotate } from 'https://unpkg.com/rough-notation?module';
  import { step, primary_color, secondary_color, tertiary_color, quaternary_color, draw_node, draw_rect, draw_arrow, draw_dashed_line } from "../utils.js";

  var background = document.querySelector('#background');
  background = annotate(background, { type: 'box', color: tertiary_color, strokeWidth: 10 });
  var message_chains = document.querySelector('#message_chains');
  message_chains = annotate(message_chains, { type: 'box', color: tertiary_color, strokeWidth: 10 });
  var command = document.querySelector('#command');
  command = annotate(command, { type: 'box', color: tertiary_color, strokeWidth: 10 });
  var positives = document.querySelector('#positives');
  positives = annotate(positives, { type: 'box', color: tertiary_color, strokeWidth: 10 });
  var negatives = document.querySelector('#negatives');
  negatives = annotate(negatives, { type: 'box', color: tertiary_color, strokeWidth: 10 });
  var solution = document.querySelector('#solution');
  solution = annotate(solution, { type: 'box', color: tertiary_color, strokeWidth: 10 });

  const to_appear = [[], 
                      [() => background.show()],
                      [() => background.hide()],
                      [() => message_chains.show()],
                      [() => message_chains.hide()],
                      [() => command.show()],
                      [() => command.hide()],
                      [() => positives.show()],
                      [() => positives.hide()],
                      [() => negatives.show()],
                      [() => negatives.hide()],
                      [() => solution.show()],
  ];
  const to_disappear = Array(to_appear.length).fill([])

  var state = 0;
  const body = document.querySelector('body');
  body.onkeydown = function (e) { state = step(e, state, to_disappear, to_appear) };
</script>

<script type='module' src="../next.js"></script>

</html>
